{% extends "base.html" %}
{% block title %}Invoice {{ invoice.invoice_number }}{% endblock %}
{% block content %}
<h1>Invoice {{ invoice.invoice_number }}</h1>

<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
  <div>
    <p><strong>Employee:</strong> {{ invoice.client.name|default:"—" }}</p>
    <p class="muted">{{ invoice.client_email }}</p> 
    <p><strong>Period:</strong> {{ invoice.period_start }} → {{ invoice.period_end }} ({{ invoice.get_period_type_display }})</p>
    <p><strong>Issued:</strong> {{ invoice.date_issued }}</p>
    <p><strong>Hourly rate:</strong> ${{ invoice.hourly_rate }}</p>
  </div>
  <div>
    <p><strong>Status:</strong> 
      {% if invoice.status == 'draft' %}
        <span class="badge bg-warning">Draft</span>
      {% elif invoice.status == 'sent' %}
        <span class="badge bg-primary">Sent</span>
      {% elif invoice.status == 'paid' %}
        <span class="badge bg-success">Paid</span>
      {% elif invoice.status == 'overdue' %}
        <span class="badge bg-danger">Overdue</span>
      {% endif %}
    </p>
  </div>
</div>

<table>
  <thead>
    <tr>
      <th>Date</th>
      <th>Weekday</th>
      <th>Description</th>
      <th>Hours</th>
      <th>Amount</th>
    </tr>
  </thead>
  <tbody>
    {% for e in invoice.work_entries.all %}
      <tr>
        <td>{{ e.work_date|date:"Y-m-d" }}</td>
        <td>{{ e.work_date|date:"l" }}</td>  {# "l" = Monday, Tuesday, ... #}
        <td>{{ e.description }}</td>
        <td>{{ e.hours }}</td>
        <td class="right">${{ e.amount|floatformat:2 }}</td>
      </tr>
    {% empty %}
      <tr><td colspan="5" class="muted">No work entries</td></tr>
    {% endfor %}
  </tbody>
<tfoot>
  <tr>
    <!-- Ocupa Date + Weekday -->
    <td colspan="3" class="right"><strong>Totals</strong></td>
    <!-- Bajo Hours -->
    <td class="right"><strong>{{ invoice.total_hours }}</strong></td>
    <!-- Bajo Amount -->
    <td class="right"><strong>${{ invoice.total_amount|floatformat:2 }}</strong></td>
    <!-- Bajo Description (vacío) -->
    <td></td>
  </tr>
</tfoot>
</table>
{% if invoice.notes %}
<p><strong>Notes:</strong> {{ invoice.notes }}</p>
{% endif %}

<div style="margin-top: 20px;">
  <h3>Actions</h3>
  <div class="d-flex gap-2 flex-wrap">
    <a class="btn btn-info" href="{% url 'invoice_pdf' invoice.pk %}">
      <i class="fas fa-file-pdf"></i> Download PDF
    </a>
    
    {% if invoice.status == 'draft' %}
      <a class="btn btn-primary" href="{% url 'invoice_mark_sent' invoice.pk %}">
        <i class="fas fa-share"></i> Mark as Sent
      </a>
    {% elif invoice.status == 'sent' %}
      <a class="btn btn-success" href="{% url 'invoice_mark_paid' invoice.pk %}">
        <i class="fas fa-dollar-sign"></i> Mark as Paid
      </a>
    {% endif %}
    
    <a class="btn btn-secondary" href="{% url 'invoice_duplicate' invoice.pk %}">
      <i class="fas fa-copy"></i> Duplicate Invoice
    </a>
  </div>
</div>
{% endblock %}